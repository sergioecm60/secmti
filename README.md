# Portal de Servicios SECMTI

**Creado por Sergio Cabrera**  
üìß [sergiomiers@gmail.com](mailto:sergiomiers@gmail.com)  
ü§ñ Asistencia t√©cnica: **Claude (Anthropic)**, Gemini (Google), ChatGPT (OpenAI) y Qwen (Alibaba)

[![PHP Version](https://img.shields.io/badge/PHP-%3E%3D8.0-8892BF.svg?style=for-the-badge)](https://php.net)
[![License](https://img.shields.io/badge/License-GPLv3-blue.svg?style=for-the-badge)](license.txt)
[![Version](https://img.shields.io/badge/Version-1.0.0-green.svg?style=for-the-badge)](https://github.com/sergioecm60/secmti/releases)
[![GitHub Repo](https://img.shields.io/badge/GitHub-Repository-181717?style=for-the-badge&logo=github)](https://github.com/sergioecm60/secmti)
[![Database](https://img.shields.io/badge/Database-MySQL%2FMariaDB-4479A1.svg?style=for-the-badge&logo=mysql)](https://www.mysql.com)

---

## üìÑ Descripci√≥n

Un **portal de servicios profesional y completo** para **gesti√≥n de infraestructura TI**, escrito en **PHP puro** sin frameworks. Dise√±ado para ser **ligero, seguro y f√°cil de administrar**, ideal para empresas que necesitan centralizar el acceso a servicios internos y gestionar su datacenter de forma eficiente.

### Caracter√≠sticas Principales

- üñ•Ô∏è **Gesti√≥n de servidores** f√≠sicos y virtuales (Proxmox, VMs, containers, cloud)
- üîë **Administraci√≥n de credenciales** segura y centralizada
- üåê **Organizaci√≥n de servicios** por categor√≠as (LAN, WAN, Sucursales)
- üìä **Dashboard** con estad√≠sticas en tiempo real
- üè¢ **Gesti√≥n de hosting** (cPanel, emails, FTP, dominios)

---

## üöÄ Versi√≥n Actual

**1.0.0** - Sistema completo de gesti√≥n de infraestructura con base de datos integrada

---

## ‚ú® Funcionalidades

### üåê P√°gina de Aterrizaje (`index.php`)
- P√°gina p√∫blica de presentaci√≥n profesional
- Informaci√≥n de contacto, sucursales y redes sociales
- Dise√±o moderno con gradientes y animaciones
- Totalmente personalizable desde el panel de administraci√≥n

### üîê Portal de Servicios (`index2.php`)
- **Dashboard de estad√≠sticas** con m√©tricas en tiempo real
- Acceso organizado por categor√≠as (LAN, WAN, Sucursales)
- **Drag & Drop** para reorganizar servicios (solo admin)
- **Secciones colapsables** para mejor organizaci√≥n
- Vista de actividad reciente del sistema
- Interfaz moderna y responsive

### üè¢ Gesti√≥n de Infraestructura (`datacenter_view.php`)
- **Inventario completo** de servidores f√≠sicos y virtuales
- Informaci√≥n detallada de hardware (CPU, RAM, discos)
- **Gesti√≥n de red** (IPs LAN/WAN, hostnames, DNS, gateway)
- **Servicios por servidor** (Proxmox, Webmin, SSH, etc.)
- **Credenciales seguras** con roles (admin/user)
- Vista expandible/colapsable por servidor
- Buscador de infraestructura

### üåê Gesti√≥n de Hosting (`hosting_manager.php`)
- Administraci√≥n de servidores cPanel/WHM
- **Cuentas de hosting** con dominios
- **Cuentas de email** organizadas por servidor
- **Cuentas FTP** con credenciales
- Panel de control centralizado

### üîí Sistema de Seguridad
- **Login con captcha matem√°tico** (protecci√≥n anti-bots)
- **Bloqueo autom√°tico** tras intentos fallidos (anti fuerza bruta)
- **Contrase√±as hasheadas** con `password_hash()` (bcrypt)
- **Tokens CSRF** en todos los formularios
- **Auditor√≠a de accesos** (logs de actividad)
- **Gesti√≥n de sesiones** con timeout autom√°tico
- **Roles de usuario** (admin/user)

### üõ†Ô∏è Panel de Administraci√≥n
- **`manage.php`**: Configuraci√≥n general del portal
- **`users_manager.php`**: Gesti√≥n de usuarios y roles
- **`datacenter_manage.php`**: CRUD completo de infraestructura
- **`hosting_manager.php`**: Gesti√≥n de servicios de hosting
- Interfaz web intuitiva sin necesidad de editar archivos

### üìä Herramientas de Monitoreo
- **`diag_x9k2.php`**: Informaci√≥n detallada del servidor PHP
- **`mytop.php`**: Monitor en tiempo real de MySQL/MariaDB
- **Dashboard**: Estad√≠sticas de infraestructura actualizadas

### üóÑÔ∏è Base de Datos Completa
- **10 tablas** para gesti√≥n integral
- **Vistas SQL** para consultas optimizadas
- **Stored Procedures** para estad√≠sticas
- **Triggers** para auditor√≠a autom√°tica

---

## üìã Requisitos del Sistema

- **Servidor web**: Apache, Nginx o similar
- **PHP**: 8.0 o superior
- **Extensiones PHP requeridas**:
  - `pdo_mysql` (acceso a base de datos)
  - `session` (manejo de sesiones)
  - `json` (procesamiento de datos)
- **Base de datos**: MySQL 5.7+ o MariaDB 10.3+
- **Permisos**: Escritura en directorio del proyecto
- **Espacio**: ~50MB (c√≥digo + base de datos inicial)

---

## üì¶ Instalaci√≥n en Servidor (Ubuntu con Apache/Nginx)

Esta gu√≠a te mostrar√° c√≥mo instalar el portal en un servidor Ubuntu. El proceso se basa en el uso de variables de entorno (`.env`) para una m√°xima seguridad.

### 1. Instalar Prerrequisitos (Pila LAMP/LEMP)

Abre una terminal en tu servidor y ejecuta los siguientes comandos para instalar el servidor web, la base de datos, PHP y las herramientas necesarias.

```bash
# Actualizar la lista de paquetes del sistema
sudo apt update && sudo apt upgrade -y

# Instalar Apache, MariaDB, PHP, Git y Composer
sudo apt install -y apache2 mariadb-server php libapache2-mod-php php-mysql php-mbstring php-xml php-json git composer

# Opcional: Si prefieres Nginx en lugar de Apache (pila LEMP)
# sudo apt install -y nginx mariadb-server php-fpm php-mysql php-mbstring php-xml php-json git composer
```

### 2. Configurar la Base de Datos

Vamos a crear una base de datos y un usuario dedicado para la aplicaci√≥n.

```bash
# 1. Accede a la consola de MariaDB/MySQL como root
sudo mysql -u root

# 2. Dentro de la consola de MySQL, ejecuta estos comandos:
CREATE DATABASE portal_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'secmti_user'@'localhost' IDENTIFIED BY 'UNA_CONTRASENA_MUY_SEGURA';
GRANT ALL PRIVILEGES ON portal_db.* TO 'secmti_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```
> ‚ö†Ô∏è **Importante**: Reemplaza `UNA_CONTRASENA_MUY_SEGURA` por una contrase√±a real y gu√°rdala para el siguiente paso.

### 3. Clonar y Configurar el Proyecto

Ahora descargaremos el c√≥digo del portal y lo configuraremos.

```bash
# 1. Clona el repositorio en el directorio web
sudo git clone https://github.com/sergioecm60/secmti.git /var/www/secmti

# 2. Navega al directorio del proyecto
cd /var/www/secmti

# 3. Instala las dependencias de PHP (como phpdotenv)
sudo composer install --no-dev --optimize-autoloader

# 4. Crea tu archivo de configuraci√≥n .env a partir del ejemplo
sudo cp .env.example .env

# 5. Genera una clave de encriptaci√≥n √∫nica y segura
php -r "echo base64_encode(random_bytes(32));"
# Copia la clave generada.

# 6. Edita el archivo .env con tus datos
sudo nano .env
```

Dentro del editor `nano`, actualiza las siguientes l√≠neas con los datos que configuraste:

```ini
# .env
APP_ENV=production
APP_URL=http://tu-dominio.com
APP_ENCRYPTION_KEY="PEGA_AQUI_LA_CLAVE_GENERADA_EN_EL_PASO_ANTERIOR"

DB_HOST=localhost
DB_NAME=portal_db
DB_USER=secmti_user
DB_PASS="LA_CONTRASENA_QUE_CREASTE_EN_EL_PASO_2"
```
> Pulsa `Ctrl+X`, luego `Y` y `Enter` para guardar y salir de `nano`.

### 4. Importar la Estructura de la Base de Datos

Con la configuraci√≥n lista, importa el esquema de la base de datos.

```bash
# Ejecuta el script de instalaci√≥n usando las credenciales que creaste
mysql -u secmti_user -p portal_db < database/install.sql
```
> Te pedir√° la contrase√±a que definiste para `secmti_user`.

### 5. Configurar Permisos

Aseg√∫rate de que el servidor web (Apache/Nginx) tenga permisos para escribir en los directorios necesarios.

```bash
# Asigna la propiedad de los archivos al usuario del servidor web (www-data en Ubuntu)
sudo chown -R www-data:www-data /var/www/secmti

# Asegura que los directorios tengan los permisos correctos
sudo chmod -R 775 /var/www/secmti/logs
```

### 6. Configurar el Servidor Web

Finalmente, crea un archivo de host virtual para que tu dominio apunte al portal.

<details>
<summary>üîµ <strong>Configuraci√≥n para Apache</strong></summary>

```bash
# 1. Crea un nuevo archivo de configuraci√≥n para tu sitio
sudo nano /etc/apache2/sites-available/secmti.conf
```

Pega el siguiente contenido, reemplazando `tu-dominio.com`:

```apache
<VirtualHost *:80>
    ServerName tu-dominio.com
    DocumentRoot /var/www/secmti

    <Directory /var/www/secmti>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/secmti_error.log
    CustomLog ${APACHE_LOG_DIR}/secmti_access.log combined
</VirtualHost>
```

```bash
# 2. Habilita el nuevo sitio, el m√≥dulo de reescritura y reinicia Apache
sudo a2ensite secmti.conf
sudo a2enmod rewrite
sudo systemctl restart apache2
```

</details>

<details>
<summary>‚ö´ <strong>Configuraci√≥n para Nginx</strong></summary>

```bash
# 1. Crea un nuevo archivo de configuraci√≥n para tu sitio
sudo nano /etc/nginx/sites-available/secmti
```

Pega el siguiente contenido, reemplazando `tu-dominio.com` y asegur√°ndote de que la versi√≥n de PHP coincida con la tuya (ej. `php8.1-fpm.sock`):

```nginx
server {
    listen 80;
    server_name tu-dominio.com;
    root /var/www/secmti;

    index index.php index.html;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock; # Verifica tu versi√≥n de PHP
    }

    location ~ /\.ht {
        deny all;
    }
}
```

```bash
# 2. Habilita el sitio creando un enlace simb√≥lico y reinicia Nginx
sudo ln -s /etc/nginx/sites-available/secmti /etc/nginx/sites-enabled/
sudo systemctl restart nginx
```

</details>

### 7. ¬°Listo!

Ahora puedes acceder a tu portal a trav√©s de `http://tu-dominio.com`. El usuario por defecto creado por el script `install.sql` es:
- **Usuario**: `admin`
- **Contrase√±a**: `password`

> üîê **¬°MUY IMPORTANTE!** Cambia esta contrase√±a inmediatamente despu√©s de tu primer inicio de sesi√≥n desde el panel de "Gesti√≥n de Usuarios".

---

## üóÑÔ∏è Estructura de Base de Datos

### Scripts SQL Incluidos

En la carpeta `database/` encontrar√°s:

1. **`install.sql`** - Instalador completo
   - Crea todas las tablas, vistas, procedures y triggers
   - Zona horaria: Argentina (UTC-3)
   - Charset: utf8mb4_spanish_ci
   - Crea un usuario `admin` con contrase√±a `password` (¬°cambiar inmediatamente!).

2. **`seed_data.sql`** - Datos de ejemplo
   - Usuarios de prueba
   - Ubicaciones y servidores
   - Servicios y credenciales
   - Datos de hosting

3. **`fix_dashboard_stats.sql`** - Arreglar dashboard
   - Recrea el procedimiento `sp_get_stats()`
   - Incluye diagn√≥stico completo

4. **`verify_dashboard.sql`** - Verificaci√≥n
   - Comprueba que todo est√© correcto
   - Diagn√≥stico de problemas

### Tablas Principales

```
users                    -- Usuarios del sistema
dc_locations            -- Ubicaciones f√≠sicas
dc_servers              -- Servidores (f√≠sicos/virtuales)
dc_services             -- Servicios por servidor
dc_credentials          -- Credenciales seguras
dc_hosting_servers      -- Servidores de hosting
dc_hosting_accounts     -- Cuentas cPanel
dc_hosting_emails       -- Cuentas de email
dc_hosting_ftp_accounts -- Cuentas FTP
dc_access_log           -- Auditor√≠a completa
```

---

## üé® Estructura del Proyecto

```
secmti/
‚îú‚îÄ‚îÄ index.php              # Landing page p√∫blica
‚îú‚îÄ‚îÄ index2.php             # Portal principal (requiere login)
‚îú‚îÄ‚îÄ login.php              # P√°gina de autenticaci√≥n
‚îú‚îÄ‚îÄ logout.php             # Cierre de sesi√≥n
‚îú‚îÄ‚îÄ bootstrap.php          # Inicializaci√≥n del sistema
‚îú‚îÄ‚îÄ config.example.php     # Template de configuraci√≥n
‚îú‚îÄ‚îÄ database.php           # Conexi√≥n PDO a MySQL
‚îÇ
‚îú‚îÄ‚îÄ api/                   # Endpoints API
‚îÇ   ‚îú‚îÄ‚îÄ auth.php
‚îÇ   ‚îú‚îÄ‚îÄ organizer.php
‚îÇ   ‚îú‚îÄ‚îÄ datacenter.php
‚îÇ   ‚îú‚îÄ‚îÄ credentials.php
‚îÇ   ‚îî‚îÄ‚îÄ hosting.php
‚îÇ
‚îú‚îÄ‚îÄ database/              # Scripts SQL
‚îÇ   ‚îú‚îÄ‚îÄ install.sql
‚îÇ   ‚îú‚îÄ‚îÄ seed_data.sql
‚îÇ   ‚îú‚îÄ‚îÄ fix_dashboard_stats.sql
‚îÇ   ‚îî‚îÄ‚îÄ verify_dashboard.sql
‚îÇ
‚îú‚îÄ‚îÄ templates/             # Componentes reutilizables
‚îÇ   ‚îú‚îÄ‚îÄ navbar.php
‚îÇ   ‚îî‚îÄ‚îÄ dashboard_stats.php
‚îÇ
‚îú‚îÄ‚îÄ assets/
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ landing.css
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index2.css
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ datacenter.css
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îú‚îÄ‚îÄ datacenter_manager.js
‚îÇ       ‚îî‚îÄ‚îÄ datacenter_view.js
‚îÇ
‚îú‚îÄ‚îÄ manage.php             # Panel de administraci√≥n
‚îú‚îÄ‚îÄ users_manager.php      # Gesti√≥n de usuarios
‚îú‚îÄ‚îÄ datacenter_view.php    # Vista infraestructura
‚îú‚îÄ‚îÄ datacenter_manage.php  # Gesti√≥n infraestructura
‚îú‚îÄ‚îÄ hosting_manager.php    # Gesti√≥n hosting
‚îú‚îÄ‚îÄ mytop.php              # Monitor MySQL
‚îú‚îÄ‚îÄ diag_x9k2.php          # Info del servidor
‚îÇ
‚îú‚îÄ‚îÄ README.md              # Este archivo
‚îú‚îÄ‚îÄ license.php            # Licencia web
‚îî‚îÄ‚îÄ license.txt            # Licencia texto
```

---

## üîß Uso del Sistema

### Para Administradores

1. **Acceder al portal**: `http://tu-servidor/secmti/index2.php`
2. **Gesti√≥n de infraestructura**: Click en "üè¢ Gesti√≥n de Infraestructura"
3. **Agregar servidor**: Click en "Agregar Servidor"
4. **Organizar servicios**: Click en "‚úèÔ∏è Organizar Botones" (modo drag & drop)
5. **Ver estad√≠sticas**: Dashboard en la p√°gina principal

### Para Usuarios

1. Login con credenciales asignadas
2. Acceso a servicios seg√∫n permisos
3. Vista de infraestructura (solo lectura)

---

## üîí Seguridad

### Mejores Pr√°cticas Implementadas

‚úÖ **Contrase√±as**: Hasheadas con `password_hash()` (bcrypt)  
‚úÖ **SQL Injection**: Queries preparadas con PDO  
‚úÖ **XSS**: `htmlspecialchars()` en todas las salidas  
‚úÖ **CSRF**: Tokens en todos los formularios  
‚úÖ **Sesiones**: Regeneraci√≥n de ID tras login  
‚úÖ **Timeout**: Sesiones expiran a los 30 minutos  
‚úÖ **Bloqueo**: Cuenta bloqueada tras 5 intentos  
‚úÖ **Auditor√≠a**: Logs de todos los accesos  

### Recomendaciones Adicionales

- üîê Usa HTTPS en producci√≥n
- üõ°Ô∏è Configura firewall (solo puertos necesarios)
- üìù Revisa logs regularmente
- üîÑ Mant√©n PHP y MySQL actualizados
- üíæ Realiza backups peri√≥dicos

---

## üêõ Soluci√≥n de Problemas

### El dashboard no muestra estad√≠sticas

```bash
mysql -u root -p portal_db < database/fix_dashboard_stats.sql
```

### Error de conexi√≥n a la base de datos

1. Verificar credenciales en `config.php`
2. Comprobar que MySQL est√© corriendo
3. Verificar permisos del usuario de BD

### No puedo hacer login

1. Verificar que la tabla `users` tenga datos
2. Comprobar que la sesi√≥n est√© iniciada
3. Limpiar cookies del navegador

### Problemas con caracteres especiales (√±, √°, √©)

Verificar en `config.php`:

```php
'database' => [
    'charset' => 'utf8mb4',
    'collation' => 'utf8mb4_spanish_ci'
]
```

---

## ü§ù Contribuciones

Las contribuciones son bienvenidas. Por favor:

1. Fork del repositorio
2. Crea una rama para tu feature
3. Commit de cambios
4. Push a la rama
5. Crea un Pull Request

---

## üìÑ Licencia

Este proyecto est√° bajo la **Licencia GNU GPL v3**.

- [`license.php`](license.php) - Versi√≥n web interactiva
- [`license.txt`](license.txt) - Texto completo de la licencia

### En Resumen

‚úÖ **Puedes**: Usar, modificar, distribuir el software libremente  
‚úÖ **Debes**: Mantener la misma licencia y dar cr√©dito al autor  
‚ùå **No hay garant√≠a**: El uso es bajo tu responsabilidad  

---

## üë®‚Äçüíª Autor

**Sergio Cabrera**  
üìß Email: [sergiomiers@gmail.com](mailto:sergiomiers@gmail.com)  
üêô GitHub: [@sergioecm60](https://github.com/sergioecm60)

---

## üôè Agradecimientos

Este proyecto fue desarrollado con la asistencia de:

- **Claude** (Anthropic) - Desarrollo de arquitectura, seguridad y gesti√≥n de infraestructura
- **Gemini** (Google) - Optimizaci√≥n de c√≥digo y consultas SQL
- **ChatGPT** (OpenAI) - Dise√±o de interfaz y experiencia de usuario
- **Qwen** (Alibaba) - Debugging y mejoras de rendimiento

---

## üóìÔ∏è Roadmap

### Versi√≥n 1.1 (Pr√≥xima)
- [ ] API REST completa
- [ ] Exportaci√≥n de inventario (PDF/Excel)
- [ ] Gr√°ficos de estad√≠sticas con Chart.js
- [ ] Sistema de notificaciones

### Versi√≥n 1.2
- [ ] Integraci√≥n con Proxmox API
- [ ] Monitoreo de servicios (ping/uptime)
- [ ] Backup autom√°tico de configuraciones
- [ ] Modo oscuro

### Versi√≥n 2.0
- [ ] Multi-tenancy (m√∫ltiples organizaciones)
- [ ] Aplicaci√≥n m√≥vil (PWA)
- [ ] Dashboard avanzado con m√©tricas
- [ ] Integraci√≥n con sistemas de tickets

---

## üìû Soporte

Para reportar bugs o solicitar features:

1. **GitHub Issues**: [Crear issue](https://github.com/sergioecm60/secmti/issues)
2. **Email**: [sergiomiers@gmail.com](mailto:sergiomiers@gmail.com)

---

‚≠ê **Si este proyecto te resulta √∫til, considera darle una estrella en GitHub!**

---

*√öltima actualizaci√≥n: Octubre 2025*