<?php
/**
 * config.php - Configuración Central de la Aplicación
 * 
 * SEGURIDAD CRÍTICA:
 * - Este archivo NUNCA debe contener credenciales reales en texto plano
 * - Usar variables de entorno para datos sensibles
 * - Agregar a .gitignore antes de cualquier commit
 * 
 * Para configurar:
 * 1. Copiar config.example.php a config.php
 * 2. Crear archivo .env con credenciales reales
 * 3. Configurar servidor web para cargar .env (o usar biblioteca como vlucas/phpdotenv)
 */

return [
    // ========================================================================
    // APLICACIÓN
    // ========================================================================
    'app' => [
        'name' => $_ENV['APP_NAME'] ?? getenv('APP_NAME') ?: 'Portal SecMTI',
        'env' => $_ENV['APP_ENV'] ?? getenv('APP_ENV') ?: 'production',
        'debug' => filter_var($_ENV['APP_DEBUG'] ?? getenv('APP_DEBUG'), FILTER_VALIDATE_BOOLEAN),
        'base_url' => $_ENV['APP_URL'] ?? getenv('APP_URL') ?: 'https://localhost',
        'timezone' => 'America/Argentina/Buenos_Aires',
    ],

    // ========================================================================
    // SEGURIDAD
    // ========================================================================
    'security' => [
        // Clave de encriptación (CRÍTICO: debe ser único por instalación)
        'encryption_key' => $_ENV['APP_ENCRYPTION_KEY'] ?? getenv('APP_ENCRYPTION_KEY') ?: '',
        
        // Intentos de login
        'max_login_attempts' => (int) ($_ENV['MAX_LOGIN_ATTEMPTS'] ?? getenv('MAX_LOGIN_ATTEMPTS') ?: 5),
        'lockout_minutes' => (int) ($_ENV['LOCKOUT_MINUTES'] ?? getenv('LOCKOUT_MINUTES') ?: 15),
        
        // IPs de proxies/balanceadores confiables
        // Solo estas IPs pueden usar X-Forwarded-For
        'trusted_proxies' => array_filter(explode(',', $_ENV['TRUSTED_PROXIES'] ?? getenv('TRUSTED_PROXIES') ?: '')),
        
        // Rate limiting por acción
        'rate_limits' => [
            'login' => [
                'max_attempts' => 5,
                'window_seconds' => 900, // 15 minutos
            ],
            'password_reset' => [
                'max_attempts' => 3,
                'window_seconds' => 3600, // 1 hora
            ],
            'api_calls' => [
                'max_attempts' => 100,
                'window_seconds' => 60, // 1 minuto
            ],
        ],
    ],

    // ========================================================================
    // BASE DE DATOS
    // ========================================================================
    'database' => [
        'host' => $_ENV['DB_HOST'] ?? getenv('DB_HOST') ?: 'localhost',
        'port' => (int) ($_ENV['DB_PORT'] ?? getenv('DB_PORT') ?: 3306),
        'name' => $_ENV['DB_NAME'] ?? getenv('DB_NAME') ?: '',
        'user' => $_ENV['DB_USER'] ?? getenv('DB_USER') ?: '',
        'pass' => $_ENV['DB_PASS'] ?? getenv('DB_PASS') ?: '',
        'charset' => 'utf8mb4',
        'collation' => 'utf8mb4_unicode_ci',
        
        // Opciones avanzadas
        'options' => [
            'timeout' => 5, // segundos
            'persistent' => false, // Conexiones persistentes (usar con cuidado)
        ],
    ],

    // ========================================================================
    // SESIONES
    // ========================================================================
    'session' => [
        'name' => 'PORTAL_SESSID',
        'timeout_seconds' => 3600,        // 1 hora de inactividad
        'max_lifetime_seconds' => 28800,  // 8 horas máximo absoluto
        'regenerate_interval' => 900,     // Regenerar ID cada 15 min
        'cookie_lifetime' => 0,           // Cookie expira al cerrar navegador
    ],

    // ========================================================================
    // LOGGING
    // ========================================================================
    'logging' => [
        'enabled' => true,
        'level' => $_ENV['LOG_LEVEL'] ?? getenv('LOG_LEVEL') ?: 'error', // debug, info, warning, error, critical
        'paths' => [
            'errors' => __DIR__ . '/logs/errors.log',
            'security' => __DIR__ . '/logs/security.log',
            'access' => __DIR__ . '/logs/access.log',
            'database' => __DIR__ . '/logs/database.log',
        ],
        'max_file_size' => 10485760, // 10MB
        'rotation_days' => 30,
    ],

    // ========================================================================
    // PÁGINA DE INICIO (LANDING)
    // ========================================================================
    'landing_page' => [
        'company_name' => 'SecMTI Soluciones',
        'logo_path' => 'assets/images/logo.png',
        
        // Ventas
        'sales_title' => 'Sistemas',
        'phone_numbers' => [
            '(011) 1234-4321',
            '0810-123-4321',
        ],
        
        // Sucursales
        'locations_title' => 'Sucursales',
        'branches' => [
            'Sucursal Central - Av. Principal 1234, CABA',
            'Sucursal Norte - Calle Secundaria 5678, San Isidro',
        ],
        
        // Redes sociales
        'social_title' => 'Encontranos en:',
        'social_links' => [
            'facebook' => [
                'label' => 'Facebook',
                'url' => 'https://www.facebook.com/tuempresa',
                'svg_path' => 'M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v2.385z',
            ],
            'instagram' => [
                'label' => 'Instagram',
                'url' => 'https://www.instagram.com/tuempresa',
                // SVG path corregido
                'svg_path' => 'M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.011-3.584.069-4.85c.149-3.225 1.664 4.771 4.919-4.919 1.266-.058 1.644.07 4.85.07zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.667.072 4.947c.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072s3.667-.014 4.947-.072c4.358-.2 6.78-2.618 6.98-6.98.059-1.281.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.2-4.358-2.618-6.78-6.98-6.98-1.281-.058-1.689-.072-4.948-.072zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z',
            ],
            'email' => [
                'label' => 'Correo Electrónico',
                'url' => 'mailto:' . ($_ENV['CONTACT_EMAIL'] ?? getenv('CONTACT_EMAIL') ?: 'contacto@tuempresa.com'),
                'svg_path' => 'M0 3v18h24v-18h-24zm21.518 2l-9.518 7.713-9.518-7.713h19.036zm-19.518 14v-11.817l10 8.104 10-8.104v11.817h-20z',
            ],
        ],
        
        // Sitios principales
        'main_sites_title' => 'Accesos Principales',
        'main_sites' => [
            'website' => [
                'url' => $_ENV['WEBSITE_URL'] ?? getenv('WEBSITE_URL') ?: 'https://www.tuempresa.com',
                'label' => 'Sitio Web Oficial',
                'svg_path' => 'M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z',
            ],
            'intranet' => [
                'url' => 'index2.php',
                'label' => 'Portal Interno',
                'svg_path' => 'M20 8h-3V6h3v2zm-5 0h-3V6h3v2zm-5 0H7V6h3v2zm10 4h-3v-2h3v2zm-5 0h-3v-2h3v2zm-5 0H7v-2h3v2zm10 4h-3v-2h3v2zm-5 0h-3v-2h3v2zm-5 0H7v-2h3v2zM4 18h3v-2H4v2zm5 0h3v-2H9v2zm5 0h3v-2h-3v2zm5-14H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2z',
            ],
        ],
    ],

    // ========================================================================
    // SERVICIOS INTERNOS
    // ========================================================================
    'services' => [
        // IMPORTANTE: No exponer URLs directas de servicios internos
        // Usar proxy reverso interno y URLs relativas
        
        'lan' => [
            'ilo_local' => [
                'label' => 'Gestión iLO',
                'url' => '/proxy/ilo', // Proxy interno
                'category' => 'Administración',
                'requires_login' => true,
                'requires_role' => 'admin',
                'icon' => 'server',
            ],
        ],
        
        'datacenter' => [
            'proxmox_master' => [
                'label' => 'Virtualización Principal',
                'url' => '/proxy/proxmox1',
                'category' => 'Infraestructura',
                'requires_login' => true,
                'requires_role' => 'admin',
                'icon' => 'cloud',
            ],
            'proxmox_slave' => [
                'label' => 'Virtualización Secundaria',
                'url' => '/proxy/proxmox2',
                'category' => 'Infraestructura',
                'requires_login' => true,
                'requires_role' => 'admin',
                'icon' => 'cloud',
            ],
            'firewall' => [
                'label' => 'Firewall',
                'url' => '/proxy/firewall',
                'category' => 'Seguridad',
                'requires_login' => true,
                'requires_role' => 'admin',
                'icon' => 'shield',
            ],
        ],
        
        // Mapeo interno real (NO expuesto al frontend)
        '_internal_proxy_map' => [
            '/proxy/ilo' => $_ENV['ILO_URL'] ?? getenv('ILO_URL') ?: 'http://192.168.0.8',
            '/proxy/proxmox1' => $_ENV['PROXMOX1_URL'] ?? getenv('PROXMOX1_URL') ?: 'https://pve1.internal:8006',
            '/proxy/proxmox2' => $_ENV['PROXMOX2_URL'] ?? getenv('PROXMOX2_URL') ?: 'https://pve2.internal:8006',
            '/proxy/firewall' => $_ENV['FIREWALL_URL'] ?? getenv('FIREWALL_URL') ?: 'https://fw.internal:443',
        ],
    ],

    // ========================================================================
    // FOOTER
    // ========================================================================
    'footer' => [
        'line1' => 'SecMTI Soluciones TI',
        'line2' => 'By Sergio Cabrera | Copyleft (ɔ) 2025',
        'license_url' => 'license.php',
        'whatsapp_number' => $_ENV['WHATSAPP_NUMBER'] ?? getenv('WHATSAPP_NUMBER') ?: '',
        'whatsapp_svg_path' => 'M19.11 4.93C17.22 3.04 14.69 2 12 2C6.48 2 2 6.48 2 12c0 1.77.46 3.45 1.27 4.95L2 22l5.05-1.27c1.5.81 3.18 1.27 4.95 1.27h.01c5.52 0 10-4.48 10-10c0-2.69-1.04-5.22-2.93-7.11zM12 20.01c-1.61 0-3.14-.4-4.51-1.13l-.32-.19l-3.34.84l.86-3.27l-.22-.34c-.8-1.4-1.22-2.99-1.22-4.63c0-4.42 3.58-8 8-8s8 3.58 8 8c0 4.42-3.58 8-8 8.01zm4.49-6.18c-.27-.13-1.59-.78-1.84-.88c-.25-.09-.43-.13-.62.13c-.19.27-.7.88-.86 1.06c-.16.19-.32.21-.59.08c-.27-.13-1.15-.42-2.19-1.35c-.81-.73-1.35-1.64-1.51-1.92c-.16-.27-.02-.43.12-.56c.12-.12.27-.32.41-.48c.14-.16.19-.27.29-.46c.1-.19.05-.36-.02-.48c-.08-.13-.62-1.49-.84-2.04c-.23-.55-.46-.48-.62-.48c-.15 0-.32-.03-.49-.03c-.17 0-.43.05-.66.32c-.22.27-.86.84-.86 2.04c0 1.2.88 2.36 1 2.53c.12.18 1.73 2.64 4.2 3.72c.59.26 1.05.41 1.41.53c.59.19 1.13.16 1.56.1c.48-.07 1.59-.65 1.81-1.27c.22-.62.22-1.16.16-1.27c-.07-.12-.25-.19-.52-.32z',
    ],

    // ========================================================================
    // EMAIL (si se usa correo)
    // ========================================================================
    'mail' => [
        'driver' => $_ENV['MAIL_DRIVER'] ?? getenv('MAIL_DRIVER') ?: 'smtp',
        'host' => $_ENV['MAIL_HOST'] ?? getenv('MAIL_HOST') ?: 'smtp.gmail.com',
        'port' => (int) ($_ENV['MAIL_PORT'] ?? getenv('MAIL_PORT') ?: 587),
        'username' => $_ENV['MAIL_USERNAME'] ?? getenv('MAIL_USERNAME') ?: '',
        'password' => $_ENV['MAIL_PASSWORD'] ?? getenv('MAIL_PASSWORD') ?: '',
        'encryption' => $_ENV['MAIL_ENCRYPTION'] ?? getenv('MAIL_ENCRYPTION') ?: 'tls',
        'from' => [
            'address' => $_ENV['MAIL_FROM_ADDRESS'] ?? getenv('MAIL_FROM_ADDRESS') ?: 'noreply@tuempresa.com',
            'name' => $_ENV['MAIL_FROM_NAME'] ?? getenv('MAIL_FROM_NAME') ?: 'Portal SecMTI',
        ],
    ],
];